# Deep Dive: API Surface

Simurgh uses Next.js App Router API routes under `app/api/*`.

This is a map of the main APIs grouped by domain. For exact request/response shapes, inspect the route files.

## Health / Setup

- `GET /api/health` — basic app health
- `GET /api/email/health` — email subsystem health
- `POST /api/setup` — initial DB/setup helpers (dev)
- `GET|POST|PUT /api/company-profile` — view/create/update the single stored profile used to prefill responses

## RFQs

- `GET /api/rfq/:id` — get RFQ document
- `POST /api/rfq/process` — create RFQ + extract fields (Gemini)
- `POST /api/rfq/:id/reprocess` — redo extraction
- `GET /api/rfq/search` — search RFQs + filters
- `POST /api/rfq/analyze-fields` — analyze extracted fields

## RFQ Responses (Drafts / Generated PDFs)

- `GET /api/rfq/:id/response` — fetch existing response (if any)
- `POST /api/rfq/:id/response` — upsert responseData as draft
- `POST /api/rfq/:id/generate` — generate filled response PDF + store URLs in `rfq_responses`
- `POST /api/rfq/:id/upload-completed` — upload a manually completed PDF (fallback path)
- `GET /api/rfq/:id/export` — export RFQ/response as CSV (reporting)
- `GET /api/rfq/:id/build-response` — build “templatePayload” + preview text from extracted RFQ

## PDF Debugging

- `GET /api/rfq/:id/pdf-fields`
  - Enumerates AcroForm fields and radio options for that RFQ PDF
  - In production this is disabled unless `ENABLE_PDF_FIELDS_DEBUG=true`
  - Optional: `?includeGeometry=true` to include widget rectangles (best-effort)

## Orders (POs) + Fulfillment

- `GET /api/orders` — list government orders (POs)
- `POST /api/orders/upload` — upload PO PDF + extract + link to RFQ (transactional)
- `GET|PATCH|DELETE /api/orders/:id` — manage order
- `POST /api/orders/:id/quality-sheet` — generate/update quality sheet
- `POST /api/orders/:id/labels` — generate labels

## Workflow Views

- `GET /api/workflow` — list workflows; supports `?status=...` and `?stats=true`
- `GET /api/workflow/:identifier` — workflow by RFQ number, PO number, or numeric ID

## Projects

- `GET /api/projects` — list projects
- `GET|PATCH /api/projects/:id` — project details
- `GET /api/projects/:id/compare` — RFQ vs PO comparison view

## S3 Helpers

- `POST /api/s3/upload` — presigned upload URL
  - Downloads are typically accessed via presigned URLs generated by other endpoints (e.g. `GET /api/rfq/:id`)

## Email Ingestion (Optional)

See `docs/EMAIL_INGESTION.md`.

## Misc / Legacy

These exist in the codebase but aren’t core to the main RFQ→PO workflow:

- `GET /api/stats`
- `GET /api/history`
